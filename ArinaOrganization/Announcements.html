<!DOCTYPE html>
<html lang="zh-tw">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0S3J891FKK"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-0S3J891FKK');
    </script>
    <meta charset="utf-8" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta name="viewport" content="width=device-width">
    <title>公告(Announcements)</title>
    <link rel="stylesheet" href="ArinaPage.css">
    <style>
        .lf{
            margin-left:5px;
            margin-right:5px;
            margin-top:2px;
            margin-bottom:2px;
        }
    </style>
</head>
<body>
    <script src="Arina.js"></script>
    <h3 style="text-align:center">公告(Announcements)</h3>
    <!--<div style="text-align:center">
        <a href="javascript:refresh_page()">更新(Refresh)</a>
        <br id="rbr" />-->
        <!--<a id="display_all" href="javascript:display_all()">顯示全部資料(Display All)</a>-->
    <!--</div>-->
    <div style="margin:auto; width:750px;">
        <form action="Announcements.html" target="_self" method="get">
            <input type="hidden" name="Page" value="1" />
            <table>
                <tr>
                    <td><label>標題名稱(Title)</label></td>
                    <td colspan="4"><input type="text" name="Title" value="" style="width:500px" /></td>
                </tr>
                <tr>
                    <td><label>日期(Date)</label></td>
                    <td>自(From)</td>
                    <td style="text-align:right;"><input id="dateFrom" type="date" name="DateFrom" value="" /></td>
                    <td>至(To)</td>
                    <td style="text-align:right;"><input id="dateTo" type="date" name="DateTo" value="" /></td>
                </tr>
                <tr>
                    <td><label>內容(Content)</label></td>
                    <td colspan="4"><input type="text" name="Content" value="" style="width:500px;" /></td>
                </tr>
                <tr style="text-align:center">
                    <td colspan="5"><input type="submit" value="搜索(Search)" /></td>
                </tr>
            </table>
        </form>
    </div>
    <hr />
    <div id="main">

    </div>
    <script>
        function getContentPart(s, maxWords = 30) {            
            var nl = s.indexOf(`\n`);
            if (s.length < maxWords && nl == -1)
                return nl == -1 ? s : s.substring(0, nl);            
            else if (nl == -1 || nl > 30)
                return `${s.substring(0, maxWords)}...`;
            else
                return `${s.substring(0, nl)}...`;
        }

        var linePerPage = 30;
        var ulp = GetURLParameter();

        var df = document.getElementById(`dateFrom`);
        var dt = document.getElementById(`dateTo`);

        df.addEventListener(`focus`, m => { if (m.target.value == "") m.target.value = GetTodayArDate(); });
        dt.addEventListener(`focus`, m => { if (m.target.value == "") m.target.value = GetTodayArDate(); });

        fetch(`Announcements.json?v=${Math.random()}`).then(m => m.json()).then(data => {
            var div = document.getElementById(`main`);
            var table, th, tr, td, a;
            table = document.createElement(`table`);
            table.style = "margin-left:auto; margin-right:auto; width:1000px;";
            table.border = 1;
            tr = document.createElement(`tr`);

            th = document.createElement(`th`);
            th.innerText = `標題(Title)`;
            tr.appendChild(th);

            th = document.createElement(`th`);
            th.innerText = `日期(Date)`;
            tr.appendChild(th);

            th = document.createElement(`th`);
            th.innerText = `內容(Content)`;
            tr.appendChild(th);
            table.appendChild(tr);

            for (let i = 0; i < data.length; i++) {
                if (data[i].Hide)
                    continue;
                tr = document.createElement(`tr`);

                td = document.createElement(`td`);
                a = document.createElement(`a`);
                a.href = `RecordDetail.html?Parent=ACS&index=${i}`;
                a.target = "_blank";
                a.innerText = getContentPart(data[i].Title, 20);
                td.appendChild(a);
                tr.appendChild(td);

                td = document.createElement(`td`);
                td.innerHTML = ChangeDateToArDate(data[i].Date);
                tr.appendChild(td);  

                td = document.createElement(`td`);
                td.innerText = getContentPart(data[i].Chinese);
                tr.appendChild(td);

                table.appendChild(tr);
                
            }            
            div.appendChild(table);
        });
    </script>
</body>
</html>